<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Le easy SCADA KBP</title>
    <!-- Favicon -->
    <link rel="icon" href="image//le-easy-logo.png" type="image/png" class="h-16 w-auto object-contain" />
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons for aesthetic icons -->
     
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Load Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body class="min-h-screen">

    <!-- MAIN APPLICATION CONTAINER -->
    <div id="app" class="hidden">
      <!-- HEADER -->
      <header
        class="bg-white shadow-md p-3 flex justify-between items-center z-10 sticky top-0"
      >
        <div class="flex items-center">
          <img
            src="image/logo_kbp.png"
            alt="Logo kbp"
            width="60"
            height="30"
            class="mr-8"
          />

          <h1 class="text-2xl font-extrabold text-blue-800">
            SCADA
          </h1>
          <span
            class="ml-4 px-3 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800"
            >Water Intake System</span
          >
        </div>
        <div class="flex items-center space-x-4">
          <!-- Health Status -->
          <div
            id="connection-status"
            class="flex items-center text-sm font-medium"
          >
            <div
              class="w-2 h-2 rounded-full bg-green-500 mr-2 status-running"
            ></div>
            <span class="text-gray-700">Gateway: ONLINE</span>
          </div>
          <div
            id="user-info"
            class="text-sm font-semibold text-gray-700 bg-gray-100 px-3 py-1 rounded-full"
          ></div>
          <button
            onclick="logout()"
            class="bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-3 rounded-md transition duration-300 flex items-center"
          >
            <i data-lucide="log-out" class="w-4 h-4 mr-1"></i> Log Out
          </button>
        </div>
      </header>

    <!-- MAIN CONTENT AREA -->
    <div class="flex min-h-[calc(100vh-64px)]">
        <!-- SIDEBAR NAVIGATION -->
        <nav class="w-64 bg-gray-800 text-white p-4 hidden lg:block">
            <div class="space-y-2">
                <a href="#" onclick="showPage('dashboard')" id="nav-dashboard" class="nav-item flex items-center p-3 rounded-lg hover:bg-blue-600 bg-blue-700 font-semibold transition duration-200">
                    <i data-lucide="layout-dashboard" class="w-5 h-5 mr-3"></i> Dashboard Intake
                </a>
                <a href="#" onclick="showPage('log_pompa')" id="nav-log_pompa" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                    <i data-lucide="history" class="w-5 h-5 mr-3"></i> Log History Pompa
                </a>
                <a href="#" onclick="showPage('log_flow')" id="nav-log_flow" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                    <i data-lucide="gauge" class="w-5 h-5 mr-3"></i> Log Totalizer Flow
                </a>
                <a href="#" onclick="showPage('log_alarm')" id="nav-log_alarm" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                    <i data-lucide="bell" class="w-5 h-5 mr-3"></i> Log Alarm & Events
              </a>
              <!-- MASTER SETTINGS - Hanya terlihat untuk ADMIN -->
                <a href="#" onclick="showPage('master_settings')" id="nav-master_settings" class="nav-item flex items-center p-3 rounded-lg hover:bg-gray-700 transition duration-200">
                    <i data-lucide="settings" class="w-5 h-5 mr-3"></i> Master Settings
              </a>
            </div>
          </nav>

          <!-- PAGE CONTENT CONTAINER -->
          <main class="flex-1 p-6 overflow-y-auto">
            <!-- Mobile Menu Toggler (Visible on small screens) -->
            <div class="lg:hidden mb-4">
              <label for="mobile-menu" class="sr-only">Pilih Halaman</label>
                <select id="mobile-menu" onchange="showPage(this.value)" class="w-full p-3 border border-gray-300 rounded-lg text-gray-700 focus:ring-blue-500 focus:border-blue-500">
                <option value="dashboard">Dashboard Intake</option>
                <option value="log_pompa">Log History Pompa</option>
                <option value="log_flow">Log Totalizer Flow</option>
                <option value="log_alarm">Log Alarm & Events</option>
                <option value="master_settings">Master Settings</option>
              </select>
            </div>

            <!-- Dashboard Page -->
            <div id="page-dashboard" class="page-content grid lg:grid-cols-3 gap-6">
              <div class="lg:col-span-3">
                <div class="mb-4 bg-sky-50 border border-sky-200 text-sky-800 rounded-lg p-3 flex items-start gap-2">
                  <i data-lucide="info" class="w-4 h-4 mt-0.5"></i>
                  <div class="text-sm">
                    <p class="font-semibold">Informasi:</p>
                    <p>Visualisasi memiliki fitur slide 1/2 (P&ID dan Ilustrasi). Gunakan tombol panah di kanan judul untuk berpindah slide.</p>
                    <p class="mt-1 text-sky-700">Catatan: Tampilan UI pada demo ini adalah mockup fungsional, bukan acuan desain final.</p>
                  </div>
                </div>
              </div>
              <!-- COLUMN 1 & 2 (Visualization & Monitoring) -->
              <div class="lg:col-span-2 space-y-6">
                <!-- VISUALISASI INTAKE -->
                <div class="scada-container">
                        <div class="flex items-center justify-between mb-4">
                            <h2 id="viz-title" class="text-xl font-bold text-gray-800">Water Intake Visualization (P&ID)</h2>
                            <div class="flex items-center gap-2 text-sm">
                                <button id="viz-prev" class="px-2 py-1 border rounded hover:bg-gray-50 flex items-center" title="Sebelumnya">
                                    <i data-lucide="chevron-left" class="w-4 h-4"></i>
                                </button>
                                <span id="viz-indicator" class="text-gray-600">1 / 2</span>
                                <button id="viz-next" class="px-2 py-1 border rounded hover:bg-gray-50 flex items-center" title="Berikutnya">
                                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                        <div class="h-96 w-full relative overflow-hidden">
                            <!-- Slide 1: SVG Skematik -->
                            <div id="slide-pid" class="absolute inset-0">
                                <svg id="intake-schematic" class="w-full h-full" viewBox="0 0 800 350" xmlns="http://www.w3.org/2000/svg">
                      <!-- Sumber Air (Kolam/Sungai) -->
                                <rect x="50" y="280" width="150" height="50" fill="#a0c4ff" stroke="#4a90e2" stroke-width="2"/>
                                <text x="125" y="310" class="text-sm font-semibold fill-blue-900" text-anchor="middle">Sumber Air</text>

                      <!-- Pompa (3 Unit) -->
                                <g id="pump-1" transform="translate(200, 230)" class="transition-all duration-300">
                                    <image href="./image/pompa.png" x="-25" y="-25" width="50" height="50" class="pump-image"/>
                                    <text x="0" y="35" text-anchor="middle" class="text-xs font-bold fill-gray-800">P1</text>
                                </g>
                                <g id="pump-2" transform="translate(200, 150)" class="transition-all duration-300">
                                    <image href="./image/pompa.png" x="-25" y="-25" width="50" height="50" class="pump-image"/>
                                    <text x="0" y="35" text-anchor="middle" class="text-xs font-bold fill-gray-800">P2</text>
                                </g>
                                <g id="pump-3" transform="translate(200, 70)" class="transition-all duration-300">
                                    <image href="./image/pompa.png" x="-25" y="-25" width="50" height="50" class="pump-image"/>
                                    <text x="0" y="35" text-anchor="middle" class="text-xs font-bold fill-gray-800">P3</text>
                      </g>

                      <!-- Pipa Intake ke Header -->
                                <path id="pipe-1" d="M 220 230 H 450" fill="none" stroke="#6c757d" stroke-width="5" class="pipe-flow"/>
                                <path id="pipe-2" d="M 220 150 H 450" fill="none" stroke="#6c757d" stroke-width="5" class="pipe-flow"/>
                                <path id="pipe-3" d="M 220 70 H 450" fill="none" stroke="#6c757d" stroke-width="5" class="pipe-flow"/>

                      <!-- Header Pipa Gabungan -->
                                <rect x="445" y="50" width="10" height="200" fill="#6c757d"/>

                      <!-- Pipa ke Flowmeter -->
                                <path id="pipe-main" d="M 455 150 H 550" fill="none" stroke="#4a90e2" stroke-width="7" class="pipe-flow"/>

                      <!-- Flowmeter -->
                      <g transform="translate(580, 150)">
                                    <rect x="-20" y="-30" width="40" height="60" fill="#9ca3af" stroke="#4b5563" stroke-width="2" rx="5"/>
                                    <circle cx="0" cy="0" r="10" fill="#3b82f6"/>
                                    <text x="0" y="40" text-anchor="middle" class="text-sm font-bold fill-gray-800">Flowmeter</text>
                                    <text id="flow-display-schematic" x="0" y="-40" text-anchor="middle" class="text-md font-bold fill-black">0 L/s</text>
                      </g>

                      <!-- Pipa ke WTP -->
                                <path d="M 600 150 H 750" fill="none" stroke="#4a90e2" stroke-width="7"/>
                                <text x="750" y="145" class="text-sm font-semibold fill-green-700" text-anchor="end">Menuju WTP</text>
                    </svg>
                            </div>
                            <!-- Slide 2: Illustration Image -->
                            <div id="slide-illustration" class="absolute inset-0 hidden">
                                <img src="illustration.png" alt="Water Intake Illustration" class="w-full h-full object-contain select-none" draggable="false" />
                            </div>
                  </div>
                </div>

                <!-- MONITORING CARDS -->
                <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <div class="bg-blue-600 text-white p-4 rounded-xl shadow-lg flex flex-col items-center">
                    <i data-lucide="zap" class="w-6 h-6 mb-2"></i>
                    <p class="text-lg font-medium">Total Debit</p>
                    <p id="monitor-debit" class="text-3xl font-bold">0 L/s</p>
                  </div>
                        <div class="bg-white text-gray-700 p-4 rounded-xl shadow-lg border flex flex-col items-center">
                            <i data-lucide="plug-zap" class="w-6 h-6 mb-2 text-yellow-600"></i>
                    <p class="text-lg font-medium">Totalizer</p>
                            <p id="monitor-totalizer" class="text-3xl font-bold">0 m³</p>
                  </div>
                        <div class="bg-white text-gray-700 p-4 rounded-xl shadow-lg border flex flex-col items-center">
                    <i data-lucide="bolt" class="w-6 h-6 mb-2 text-red-600"></i>
                    <p class="text-lg font-medium">Pompa Aktif</p>
                            <p id="monitor-active-pumps" class="text-3xl font-bold">0 / 3</p>
                  </div>
                </div>

                <!-- ACTIVE ALARMS & EVENTS -->
                <div class="scada-container">
                  <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-gray-800">Alarms & Events Aktif</h2>
                            <span id="alarm-count" class="px-3 py-1 text-sm font-bold rounded-full bg-green-200 text-green-800">0 Aktif</span>
                  </div>
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Waktu</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Prioritas</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Deskripsi</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th>
                      </tr>
                    </thead>
                            <tbody id="alarm-list" class="bg-white divide-y divide-gray-200">
                      <!-- Alarm rows will be inserted here -->
                                <tr><td colspan="5" class="py-4 text-center text-gray-500">Tidak ada alarm aktif saat ini.</td></tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <!-- COLUMN 3 (Control Panel & Detail Monitoring) -->
              <div class="lg:col-span-1 space-y-6">
                <!-- CONTROL PANEL -->
                    <div class="bg-white p-6 rounded-xl shadow-lg border border-blue-200">
                        <h2 class="text-xl font-bold text-blue-700 mb-4">Control Panel</h2>

                  <!-- Mode Selector -->
                  <div id="control-mode-panel" class="mb-4">
                            <p class="text-sm font-medium text-gray-600 mb-2">Mode Operasi Saat Ini:</p>
                            <div class="flex rounded-lg border border-gray-300 divide-x divide-gray-300 text-sm font-semibold">
                                <button id="mode-auto" onclick="setMode('AUTO')" class="flex-1 p-2 rounded-l-lg transition duration-200">AUTO</button>
                                <button id="mode-remote" onclick="setMode('REMOTE')" class="flex-1 p-2 transition duration-200">MANUAL</button>
                                <button id="mode-manual" onclick="setMode('MANUAL')" class="flex-1 p-2 rounded-r-lg transition duration-200">REMOTE</button>
                    </div>
                  </div>

                  <!-- AUTO/REMOTE CONTROL -->
                  <div id="auto-control-section" class="border-t pt-4 hidden">
                            <h3 class="font-bold text-lg mb-2">Kontrol Sistem (Mode <span id="current-mode-display">REMOTE</span>)</h3>
                    <div class="space-y-3">
                                <label for="target-debit" class="block text-sm font-medium text-gray-700">Target Debit (Setpoint L/s)</label>
                                <input type="number" id="target-debit" min="0" max="150" step="5" class="w-full p-2 border rounded-lg focus:ring-blue-500 focus:border-blue-500" value="100">
                                <button onclick="setSystemSetpoint()" id="setpoint-btn" class="w-full py-2 px-4 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition duration-300">
                        APLIKASIKAN SETPOINT
                      </button>
                    </div>
                  </div>

                  <!-- REMOTE MODE INFO (Sistem Offline) -->
                        <div id="remote-mode-info" class="border-t pt-4 mt-4">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <h3 class="font-bold text-lg text-red-600 mb-3 flex items-center">
                                    <i data-lucide="wifi-off" class="w-5 h-5 mr-2"></i> Mode Manual - Sistem Offline
                                </h3>
                                <p class="text-sm text-red-700 mb-2">
                                    <strong>SCADA terputus dari dashboard.</strong> Panel kontrol di setting offline dan tidak dapat diakses via dashboard.
                                </p>
                                <p class="text-sm text-gray-600">
                                    Kontrol sistem dan setup debit air tidak tersedia dalam mode ini.
                                </p>
                            </div>
                        </div>

                  <!-- MANUAL PUMP CONTROL (Hanya terlihat di mode MANUAL) -->
                        <div id="manual-control-section" class="border-t pt-4 mt-4 hidden">
                            <h3 class="font-bold text-lg text-red-600 mb-3 flex items-center">
                                <i data-lucide="lock" class="w-5 h-5 mr-2"></i> Kontrol Pompa Remote
                    </h3>
                            <p id="manual-control-info" class="text-sm text-gray-500 mb-3 italic">Fitur ini hanya dapat diakses oleh Admin.</p>
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-3">
                                <p class="text-sm text-yellow-800 flex items-center">
                                    <i data-lucide="thermometer" class="w-4 h-4 mr-2"></i>
                                    <strong>Info:</strong> Speed minimum 70% diperlukan untuk cooling fan mencegah overheat. Slider dibatasi minimum 70% di mode REMOTE.
                                </p>
                            </div>
                    <!-- Pompa 1 -->
                            <div class="p-3 bg-gray-50 rounded-lg mb-2 flex items-center justify-between">
                      <span class="font-semibold">Pompa 1</span>
                      <div class="flex items-center space-x-2">
                                    <button onclick="togglePump(1)" id="pump-1-toggle" class="px-3 py-1 text-sm rounded-lg font-medium bg-gray-300"></button>
                                    <input type="range" min="70" max="100" value="0" class="w-24 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg" onchange="setManualSpeed(1, this.value)" title="Min 70% untuk cooling fan">
                                    <span id="pump-1-manual-speed" class="text-sm font-bold w-10 text-right">0%</span>
                      </div>
                    </div>
                    <!-- Pompa 2 -->
                            <div class="p-3 bg-gray-50 rounded-lg mb-2 flex items-center justify-between">
                      <span class="font-semibold">Pompa 2</span>
                      <div class="flex items-center space-x-2">
                                    <button onclick="togglePump(2)" id="pump-2-toggle" class="px-3 py-1 text-sm rounded-lg font-medium bg-gray-300"></button>
                                    <input type="range" min="70" max="100" value="0" class="w-24 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg" onchange="setManualSpeed(2, this.value)" title="Min 70% untuk cooling fan">
                                    <span id="pump-2-manual-speed" class="text-sm font-bold w-10 text-right">0%</span>
                      </div>
                    </div>
                    <!-- Pompa 3 -->
                            <div class="p-3 bg-gray-50 rounded-lg flex items-center justify-between">
                      <span class="font-semibold">Pompa 3</span>
                      <div class="flex items-center space-x-2">
                                    <button onclick="togglePump(3)" id="pump-3-toggle" class="px-3 py-1 text-sm rounded-lg font-medium bg-gray-300"></button>
                                    <input type="range" min="70" max="100" value="0" class="w-24 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer range-lg" onchange="setManualSpeed(3, this.value)" title="Min 70% untuk cooling fan">
                                    <span id="pump-3-manual-speed" class="text-sm font-bold w-10 text-right">0%</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- DETAIL MONITORING PER POMPA -->
                <div class="bg-white p-6 rounded-xl shadow-lg border">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Detail VFD Monitoring</h2>
                  <div id="pump-details" class="space-y-4">
                    <!-- Detail Pompa 1 -->
                    <div class="p-3 rounded-lg border" id="detail-p1">
                      <h4 class="font-bold text-blue-600">Pompa 1</h4>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Speed (%):</span><span id="p1-speed-pct" class="font-semibold">0%</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">RPM:</span><span id="p1-rpm" class="font-semibold">0 rpm</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Frequency:</span><span id="p1-frequency" class="font-semibold">0.0 Hz</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Arus (A):</span><span id="p1-current" class="font-semibold">0.0 A</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Tegangan (V):</span><span id="p1-voltage" class="font-semibold">380 V</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Status:</span><span id="p1-status" class="font-semibold text-gray-500">STOP</span></div>
                    </div>
                    <!-- Detail Pompa 2 -->
                    <div class="p-3 rounded-lg border" id="detail-p2">
                      <h4 class="font-bold text-blue-600">Pompa 2</h4>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Speed (%):</span><span id="p2-speed-pct" class="font-semibold">0%</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">RPM:</span><span id="p2-rpm" class="font-semibold">0 rpm</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Frequency:</span><span id="p2-frequency" class="font-semibold">0.0 Hz</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Arus (A):</span><span id="p2-current" class="font-semibold">0.0 A</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Tegangan (V):</span><span id="p2-voltage" class="font-semibold">380 V</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Status:</span><span id="p2-status" class="font-semibold text-gray-500">STOP</span></div>
                    </div>
                    <!-- Detail Pompa 3 -->
                    <div class="p-3 rounded-lg border" id="detail-p3">
                      <h4 class="font-bold text-blue-600">Pompa 3</h4>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Speed (%):</span><span id="p3-speed-pct" class="font-semibold">0%</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">RPM:</span><span id="p3-rpm" class="font-semibold">0 rpm</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Frequency:</span><span id="p3-frequency" class="font-semibold">0.0 Hz</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Arus (A):</span><span id="p3-current" class="font-semibold">0.0 A</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Tegangan (V):</span><span id="p3-voltage" class="font-semibold">380 V</span></div>
                                <div class="flex justify-between text-sm py-1"><span class="text-gray-600">Status:</span><span id="p3-status" class="font-semibold text-gray-500">STOP</span></div>
                      </div>
                      </div>
                </div>
              </div>
            </div>

            <!-- Master Settings Page -->
            <div id="page-master_settings" class="page-content hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                    <i data-lucide="lock" class="w-6 h-6 mr-2 text-red-600"></i> Master Settings (Algoritma & Threshold)
              </h2>
              <div class="mb-6 bg-yellow-50 border border-yellow-200 text-yellow-800 rounded-lg p-3 flex items-start gap-2">
                <i data-lucide="info" class="w-4 h-4 mt-0.5"></i>
                <div class="text-sm">
                  <p class="font-semibold">Informasi:</p>
                  <p>Pengaturan di halaman ini hanya simulasi fungsi. Desain bukan acuan final implementasi.</p>
                </div>
              </div>
              <div id="settings-content" class="space-y-6">
        <!-- AUTO DEFAULT PRIORITY SETTINGS -->
        <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                <h3 class="text-xl font-bold text-blue-700 mb-4">Prioritas Pompa Aktif Default (Mode AUTO)</h3>
          <p class="text-sm text-gray-600 mb-3">Urutkan prioritas pompa 1-3 (tanpa duplikasi). Sistem akan mengaktifkan sesuai urutan ini ketika mode AUTO.</p>
          <div class="grid md:grid-cols-3 gap-4">
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Prioritas #1</label>
              <select id="prio-1" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="1">Pompa 1</option>
                <option value="2">Pompa 2</option>
                <option value="3">Pompa 3</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Prioritas #2</label>
              <select id="prio-2" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="1">Pompa 1</option>
                <option value="2">Pompa 2</option>
                <option value="3">Pompa 3</option>
              </select>
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Prioritas #3</label>
              <select id="prio-3" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                <option value="1">Pompa 1</option>
                <option value="2">Pompa 2</option>
                <option value="3">Pompa 3</option>
              </select>
            </div>
          </div>
          <div class="flex gap-3 mt-4">
            <button id="save-priority" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Simpan Prioritas</button>
            <span id="priority-hint" class="text-sm text-gray-500"></span>
          </div>
        </div>
                <!-- MASTER STAGING TABLE -->
                <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                        <h3 class="text-xl font-bold text-blue-700 mb-4">Master Staging Algoritma Pompa (Kontrol Debit)</h3>
                  <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                      <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Target Debit (L/s)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Max Speed Pompa Tunggal (%)</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Max Sum Active Pump</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Aksi</th>
                      </tr>
                    </thead>
                            <tbody id="staging-table-body" class="bg-white divide-y divide-gray-200">
                      <!-- Data Mock/Simulasi - Updated for 50 L/s per pump -->
                      <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">35</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">70%</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">1</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><a href="#" class="text-indigo-600 hover:text-indigo-900">Edit</a></td>
                      </tr>
                      <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">75</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">75%</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><a href="#" class="text-indigo-600 hover:text-indigo-900">Edit</a></td>
                      </tr>
                      <tr>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">150</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">100%</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">3</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><a href="#" class="text-indigo-600 hover:text-indigo-900">Edit</a></td>
                      </tr>
                    </tbody>
                  </table>
                        <button class="mt-4 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition duration-300">Tambahkan Threshold Baru</button>
                </div>

                <!-- ALARM THRESHOLDS -->
                <div class="bg-white p-6 rounded-xl shadow-lg">
                        <h3 class="text-xl font-bold text-red-600 mb-4">Master Alarm Thresholds (Protection)</h3>
                  <div class="grid md:grid-cols-2 gap-4">
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-semibold">Arus Pompa Drift</h4>
                                <p class="text-sm text-gray-600">Arus Maks Normal: <span class="font-bold text-orange-500">12.0 A</span></p>
                    </div>
                    <div class="p-4 border rounded-lg">
                      <h4 class="font-semibold">Saringan (Filter)</h4>
                                <p class="text-sm text-gray-600">Interval Bersih: <span class="font-bold text-green-500">7 Hari</span></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Placeholder for Log History and Log Alarm pages -->
            <div id="page-log_pompa" class="page-content hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Log History Penggunaan Pompa</h2>
                <div class="mb-4 bg-sky-50 border border-sky-200 text-sky-800 rounded-lg p-3 flex items-start gap-2">
                  <i data-lucide="info" class="w-4 h-4 mt-0.5"></i>
                  <div class="text-sm">
                    <p class="font-semibold">Informasi:</p>
                    <p>Filter dan grafik pada halaman ini adalah simulasi data untuk tujuan demo fungsi. Desain UI bukan acuan final.</p>
                  </div>
                </div>
                
                <!-- CHART SECTION -->
                <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Grafik Performa Pompa</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-2">Speed Pompa (%)</h4>
                            <canvas id="pumpSpeedChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-2">Arus Pompa (A)</h4>
                            <canvas id="pumpCurrentChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg space-y-4">
                    <div class="grid md:grid-cols-6 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Tanggal Dari</label>
                            <input type="date" id="pump-date-from" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Tanggal Hingga</label>
                            <input type="date" id="pump-date-to" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Pompa</label>
                            <select id="pump-id" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="ALL">Semua</option>
                                <option value="1">Pompa 1</option>
                                <option value="2">Pompa 2</option>
                                <option value="3">Pompa 3</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Status</label>
                            <select id="pump-status" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="ALL">Semua</option>
                                <option value="RUNNING">RUNNING</option>
                                <option value="STOP">STOP</option>
                                <option value="FAULT">FAULT</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Speed Min (%)</label>
                            <input type="number" step="1" id="pump-speed-min" placeholder="0" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Arus Min (A)</label>
                            <input type="number" step="0.1" id="pump-current-min" placeholder="0.0" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <div class="grid md:grid-cols-4 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Speed Max (%)</label>
                            <input type="number" step="1" id="pump-speed-max" placeholder="" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Arus Max (A)</label>
                            <input type="number" step="0.1" id="pump-current-max" placeholder="" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Totalizer Min (Jam)</label>
                            <input type="number" step="0.01" id="pump-totalizer-min" placeholder="0.00" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Cari (Deskripsi/Note)</label>
                            <input type="text" id="pump-search" placeholder="kata kunci..." class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button id="pump-apply" class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">Terapkan Filter</button>
                        <button id="pump-reset" class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg text-sm hover:bg-gray-300">Reset</button>
                        <button id="pump-export" class="px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-1"></i> Export CSV
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Waktu</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Pompa</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Speed (%)</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Arus (A)</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Totalizer Jam</th>
                                </tr>
                            </thead>
                            <tbody id="pump-log-body" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="6" class="py-4 text-center text-gray-500">Belum ada riwayat pompa.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="flex items-center justify-between pt-2">
                        <div class="text-sm text-gray-600">
                            <span id="pump-page-info">Halaman 1</span>
                        </div>
                        <div class="space-x-2">
                            <button id="pump-prev" class="px-3 py-1 rounded border text-sm hover:bg-gray-50">Prev</button>
                            <button id="pump-next" class="px-3 py-1 rounded border text-sm hover:bg-gray-50">Next</button>
                        </div>
                    </div>
              </div>
            </div>
            <div id="page-log_flow" class="page-content hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Log History Totalizer Flowmeter</h2>
                <div class="mb-4 bg-sky-50 border border-sky-200 text-sky-800 rounded-lg p-3 flex items-start gap-2">
                  <i data-lucide="info" class="w-4 h-4 mt-0.5"></i>
                  <div class="text-sm">
                    <p class="font-semibold">Informasi:</p>
                    <p>Data debit dan totalizer pada halaman ini merupakan simulasi. Tampilan hanya untuk menunjukkan alur fungsi.</p>
                  </div>
                </div>
                
                <!-- CHART SECTION -->
                <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Grafik Debit & Totalizer</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-2">Debit Air (L/s)</h4>
                            <canvas id="flowDebitChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-2">Totalizer (m³)</h4>
                            <canvas id="flowTotalizerChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg space-y-4">
                    <div class="grid md:grid-cols-6 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Tanggal Dari</label>
                            <input type="date" id="flow-date-from" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Tanggal Hingga</label>
                            <input type="date" id="flow-date-to" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Debit Min (L/s)</label>
                            <input type="number" step="0.1" id="flow-debit-min" placeholder="0" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Debit Max (L/s)</label>
                            <input type="number" step="0.1" id="flow-debit-max" placeholder="" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Totalizer Min (m³)</label>
                            <input type="number" step="0.01" id="flow-total-min" placeholder="" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Totalizer Max (m³)</label>
                            <input type="number" step="0.01" id="flow-total-max" placeholder="" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button id="flow-apply" class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">Terapkan Filter</button>
                        <button id="flow-reset" class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg text-sm hover:bg-gray-300">Reset</button>
                        <button id="flow-export" class="px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-1"></i> Export CSV
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Waktu</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Debit (L/s)</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Totalizer (m³)</th>
                                </tr>
                            </thead>
                            <tbody id="flow-log-body" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="3" class="py-4 text-center text-gray-500">Belum ada riwayat flow.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="flex items-center justify-between pt-2">
                        <div class="text-sm text-gray-600">
                            <span id="flow-page-info">Halaman 1</span>
                        </div>
                        <div class="space-x-2">
                            <button id="flow-prev" class="px-3 py-1 rounded border text-sm hover:bg-gray-50">Prev</button>
                            <button id="flow-next" class="px-3 py-1 rounded border text-sm hover:bg-gray-50">Next</button>
                        </div>
                    </div>
              </div>
            </div>
            <div id="page-log_alarm" class="page-content hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Log Alarm & Events (Lengkap)</h2>
                <div class="mb-4 bg-sky-50 border border-sky-200 text-sky-800 rounded-lg p-3 flex items-start gap-2">
                  <i data-lucide="info" class="w-4 h-4 mt-0.5"></i>
                  <div class="text-sm">
                    <p class="font-semibold">Informasi:</p>
                    <p>Riwayat alarm pada demo ini terbentuk dari event simulasi. Desain UI bukan referensi desain akhir.</p>
                  </div>
                </div>
                
                <!-- CHART SECTION -->
                <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg mb-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">Grafik Alarm & Events</h3>
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-2">Frekuensi Alarm per Prioritas</h4>
                            <canvas id="alarmPriorityChart" width="400" height="200"></canvas>
                        </div>
                        <div>
                            <h4 class="text-md font-semibold text-gray-700 mb-2">Timeline Events</h4>
                            <canvas id="alarmTimelineChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white p-4 md:p-6 rounded-xl shadow-lg space-y-4">
                    <div class="grid md:grid-cols-5 gap-3">
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Tanggal Dari</label>
                            <input type="date" id="log-date-from" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Tanggal Hingga</label>
                            <input type="date" id="log-date-to" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Prioritas</label>
                            <select id="log-priority" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="ALL">Semua</option>
                                <option value="CRITICAL">CRITICAL</option>
                                <option value="WARNING">WARNING</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Event</label>
                            <select id="log-event" class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                                <option value="ALL">Semua</option>
                                <option value="RAISE">RAISE</option>
                                <option value="ACK">ACK</option>
                                <option value="CLEAR">CLEAR</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-xs font-medium text-gray-600 mb-1">Cari (Deskripsi)</label>
                            <input type="text" id="log-search" placeholder="Kata kunci..." class="w-full p-2 border rounded-lg text-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                    </div>

                    <div class="flex flex-wrap gap-3">
                        <button id="log-apply" class="px-3 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700">Terapkan Filter</button>
                        <button id="log-reset" class="px-3 py-2 bg-gray-200 text-gray-800 rounded-lg text-sm hover:bg-gray-300">Reset</button>
                        <button id="log-export" class="px-3 py-2 bg-green-600 text-white rounded-lg text-sm hover:bg-green-700 flex items-center">
                            <i data-lucide="download" class="w-4 h-4 mr-1"></i> Export CSV
                        </button>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Waktu</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Event</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Prioritas</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Deskripsi</th>
                                </tr>
                            </thead>
                            <tbody id="alarm-log-body" class="bg-white divide-y divide-gray-200">
                                <tr><td colspan="4" class="py-4 text-center text-gray-500">Belum ada riwayat alarm.</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="flex items-center justify-between pt-2">
                        <div class="text-sm text-gray-600">
                            <span id="log-page-info">Halaman 1</span>
                        </div>
                        <div class="space-x-2">
                            <button id="log-prev" class="px-3 py-1 rounded border text-sm hover:bg-gray-50">Prev</button>
                            <button id="log-next" class="px-3 py-1 rounded border text-sm hover:bg-gray-50">Next</button>
                        </div>
                    </div>
              </div>
            </div>

            <!-- Simple Modal for Alert/Warning -->
            <div id="custom-alert-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 items-center justify-center">
              <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full">
                    <h3 id="modal-title" class="text-xl font-bold text-red-600 mb-3">Peringatan Sistem</h3>
                <p id="modal-message" class="text-gray-700 mb-4"></p>
                    <button onclick="hideAlertModal()" class="w-full py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600">Tutup</button>
              </div>
            </div>

          </main>
      </div>
       <!-- FOOTER -->
           <footer
             class="h-16 mt-auto w-full bg-gray-900 font-semibold flex items-center justify-center text-sm text-gray-300"
           >
            <p>
              scada.leeasy.id – Powered by
              <a
                href="https://nawatara.com/"
                class="text-blue-500 hover:underline"
                target="_blank"
              >
              NawaTara Tech
              </a>
            </p>
          </footer>
    </div>


    <!-- LOGIN PAGE -->
<div id="login-page" class="flex items-center justify-center min-h-screen bg-gray-100" style="background-image:url('illustration.png'); background-size:cover; background-position:center;">
    <div class="bg-white/80 backdrop-blur-sm border border-white/40 p-8 rounded-xl shadow-2xl w-full max-w-md">
        <h2 class="text-3xl font-bold text-center text-blue-700 mb-6">Login SCADA KBP</h2>
        <div class="mb-4">
            <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
            <input type="text" id="username" class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="admin, spv, atau tamu">
        </div>
        <div class="mb-6">
            <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
            <input type="password" id="password" class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500" placeholder="123">
        </div>
        <button onclick="login()" class="w-full py-3 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 transition duration-300">
          Login
        </button>
        <p class="text-center text-sm text-gray-500 mt-4">Demo: Admin/123, SPV/123, atau Tamu/123</p>
      </div>
    </div>

   <script src="script.js"></script>
  </body>
</html>